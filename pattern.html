<video id="video" autoplay playsinline style="display:none;"></video>
<img id="palmImage" src="image_on_palm.png" style="position:absolute;"/>

<script type="module">
  async function main() {
    const video = await setupCamera();
    document.body.appendChild(video);
    video.play();

    detectHand(video); // Start hand detection and rendering image
  }

  async function setupCamera() {
    const video = document.createElement('video');
    const devices = await navigator.mediaDevices.enumerateDevices();
    const videoDevices = devices.filter(device => device.kind === 'videoinput');
    const rearCamera = videoDevices.find(device => device.label.toLowerCase().includes('back'));

    const constraints = {
      video: {
        deviceId: rearCamera.deviceId,
        width: { ideal: 1280 },
        height: { ideal: 720 },
        frameRate: { ideal: 30 }
      }
    };

    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = stream;
    return new Promise((resolve) => {
      video.onloadedmetadata = () => {
        resolve(video);
      };
    });
  }

  async function detectHand(video) {
    const model = await handpose.load();
    
    async function predictHands() {
      const predictions = await model.estimateHands(video);

      if (predictions.length > 0) {
        const keypoints = predictions[0].landmarks;
        renderImageOnPalm(keypoints);
      }
      
      requestAnimationFrame(predictHands);
    }
    
    predictHands();
  }

  function renderImageOnPalm(keypoints) {
    const palmPosition = keypoints[9]; // Palm's position (or other keypoints if needed)
    
    const image = document.getElementById('palmImage');
    image.style.left = `${palmPosition[0]}px`;
    image.style.top = `${palmPosition[1]}px`;
  }

  main();
</script>
